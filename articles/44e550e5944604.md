---
title: "vldã‚’ä½¿ã£ã¦PHPã®opcodeã‚’å‡ºåŠ›ã™ã‚‹"
emoji: "ğŸ‘Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["PHP"]
published: false
---

VLD (Vulcan Logic Disassembler) ã¯ã€PHPã®opcodeã‚’ã€ãƒ€ãƒ³ãƒ—ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ä»Šå›ã¯Dockerã‚’ä½¿ã£ã¦VLDã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã€PHPã‚¹ã‚¯ãƒªãƒ—ãƒˆã®opcodeã‚’å‡ºåŠ›ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

```docker-compose.yml
services:
  php-vld:
    build: .
    volumes:
      - ./scripts:/app/scripts
    tty: true
    stdin_open: true
```

```Dockerfile
FROM php:8.4-cli

# Install VLD extension
RUN pecl install channel://pecl.php.net/vld-0.19.1 && \
    docker-php-ext-enable vld

# Set working directory
WORKDIR /app

# Keep container running
CMD ["tail", "-f", "/dev/null"]
```

## ä½¿ç”¨æ–¹æ³•

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

æ¤œè¨¼ã—ãŸã„PHPã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’`./scripts`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã«ãªã‚Šã¾ã™ã€‚

```
.
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ scripts
    â”œâ”€â”€ test.php
    â”œâ”€â”€ test2.php
    â””â”€â”€ test3.php
```

```php:scripts/test.php
<?php
echo 'Hello World!' . PHP_EOL;
```

### å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
docker compose run --rm php-vld \
php -d vld.active=1 -d vld.execute=0 \
/app/scripts/test.php
```

```txt:å‡ºåŠ›çµæœ
Finding entry points
Branch analysis from position: 0
1 jumps found. (Code = 62) Position 1 = -2
filename:       /app/scripts/test.php
function name:  (null)
number of ops:  2
compiled vars:  none
line      #* E I O op                               fetch          ext  return  operands
-----------------------------------------------------------------------------------------
    2     0  E >   ECHO                                                         'Hello+World%21%0A'
          1      > RETURN                                                       1

branch: #  0; line:     2-    2; sop:     0; eop:     1; out0:  -2
path #1: 0,
```